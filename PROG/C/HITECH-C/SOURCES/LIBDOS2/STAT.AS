global	_stat
global	ncsv, cret, indir, bDos
global	__flip
global	_errno
global	shlr
psect	text
_stat:
call ncsv
defw -149
ld	l,(ix+6)
ld	h,(ix+7)
push	hl
pop	iy
ld	hl,67
push	hl
push	iy
push	ix
pop	de
ld	hl,-149
add	hl,de
push	hl
call	__flip
pop	bc
pop	bc
pop	bc
ld	a,l
or	h
jp	nz,l6
L4:
ld	hl,-1
jp	cret
l6:
push	ix
pop	de
push	de
ld	ix,-82
add	ix,de
ld	hl,-149
add	hl,de
ex	de,hl
ld	bc,1640h ; 40h : _FFIRST 16h: also hidden, system and directory
call	bDos
pop	ix
jp	z,L3
ld	(_errno),a
xor	a
ld	(_errno+1),a
jp	L4
L3:
bit	4,(ix+-68)
jp	nz,L2
ld	hl,768
jp	L1
L2:
ld	hl,1344
L1:
ex	de,hl
ld	l,(ix+8)
ld	h,(ix+9)
ld	(hl),e
inc	hl
ld	(hl),d
bit	0,(ix+-68)
jp	nz,l7
dec	hl
ld	c,(hl)
inc	hl
ld	b,(hl)
set	7,c
ld	(hl),b
dec	hl
ld	(hl),c
l7:
bit	1,(ix+-68)
jp	z,l8
ld	l,(ix+8)
ld	h,(ix+9)
ld	c,(hl)
inc	hl
ld	b,(hl)
set	4,b
ld	(hl),b
dec	hl
ld	(hl),c
l8:
bit	2,(ix+-68)
jp	z,l9
ld	l,(ix+8)
ld	h,(ix+9)
ld	c,(hl)
inc	hl
ld	b,(hl)
set	5,b
ld	(hl),b
dec	hl
ld	(hl),c
l9:
bit	5,(ix+-68)
jp	z,l10
ld	l,(ix+8)
ld	h,(ix+9)
ld	c,(hl)
inc	hl
ld	b,(hl)
set	6,b
ld	(hl),b
dec	hl
ld	(hl),c
l10:
ld	a,(ix+-67)
and	31
ld	l,a
xor	a
ld	h,a
add	hl,hl
ld	(ix+-18),l
ld	(ix+-17),h
ld	b,5
ld	l,(ix+-67)
ld	h,(ix+-66)
call	shlr
ld	a,l
and	63
ld	l,a
xor	a
ld	h,a
ld	(ix+-16),l
ld	(ix+-15),h
ld	b,11
ld	l,(ix+-67)
ld	h,(ix+-66)
call	shlr
ld	a,l
and	31
ld	l,a
xor	a
ld	h,a
ld	(ix+-14),l
ld	(ix+-13),h
ld	a,(ix+-65)
and	31
ld	l,a
xor	a
ld	(ix+-12),l
ld	(ix+-11),h
ld	b,5
ld	l,(ix+-65)
ld	h,(ix+-64)
call	shlr
ld	a,l
and	15
ld	l,a
xor	a
ld	h,a
ld	(ix+-10),l
ld	(ix+-9),h
ld	b,9
ld	l,(ix+-65)
ld	h,(ix+-64)
call	shlr
ld	a,l
and	127
ld	e,a
xor	a
ld	d,a
ld	hl,1980
add	hl,de
ld	(ix+-8),l
ld	(ix+-7),h
push	ix
pop	de
ld	hl,-18
add	hl,de
push	hl
call	_seconds
pop	bc
push	hl
push	de
ld	l,(ix+8)
ld	h,(ix+9)
inc	hl
inc	hl
pop	de
ld	(hl),e
inc	hl
ld	(hl),d
inc	hl
pop	bc
ld	(hl),c
inc	hl
ld	(hl),b
ld	l,c
ld	h,b
push	hl
push	de
ld	e,(ix+8)
ld	d,(ix+9)
ld	hl,6
add	hl,de
pop	de
ld	(hl),e
inc	hl
ld	(hl),d
inc	hl
pop	bc
ld	(hl),c
inc	hl
ld	(hl),b
ld	e,(ix+-61)
ld	d,(ix+-60)
ld	l,(ix+-59)
ld	h,(ix+-58)
push	hl
push	de
ld	e,(ix+8)
ld	d,(ix+9)
ld	hl,10
add	hl,de
pop	de
ld	(hl),e
inc	hl
ld	(hl),d
inc	hl
pop	bc
ld	(hl),c
inc	hl
ld	(hl),b
ld	hl,0
jp	cret
psect	data
F53:
defw	0
defw	31
defw	59
defw	90
defw	120
defw	151
defw	181
defw	212
defw	243
defw	273
defw	304
defw	334
global	adiv
global	amul
global	aslladd
global	wrelop
global	aslladd
global	llmul
global	lladd
global	llmul
global	lladd
global	llmul
global	lladd
psect	text
_seconds:
call ncsv
defw -6
ld	e,(ix+6)
ld	d,(ix+7)
ld	hl,10
add	hl,de
ld	c,(hl)
inc	hl
ld	b,(hl)
ld	hl,-1969
add	hl,bc
ld	de,4
call	adiv
push	hl
ld	e,(ix+6)
ld	d,(ix+7)
ld	hl,10
add	hl,de
ld	c,(hl)
inc	hl
ld	b,(hl)
ld	hl,-1970
add	hl,bc
ld	de,365
call	amul
pop	de
add	hl,de
ex	de,hl
ld	hl,0
ld	(ix+-6),e
ld	(ix+-5),d
ld	(ix+-4),l
ld	(ix+-3),h
ld	e,(ix+6)
ld	d,(ix+7)
ld	hl,6
add	hl,de
ld	c,(hl)
inc	hl
ld	b,(hl)
ld	hl,8
add	hl,de
ld	a,(hl)
inc	hl
ld	h,(hl)
ld	l,a
dec	hl
add	hl,hl
ld	de,F53
add	hl,de
ld	a,(hl)
inc	hl
ld	h,(hl)
ld	l,a
add	hl,bc
dec	hl
ex	de,hl
ld	hl,0
push	hl
push	de
push	ix
pop	de
ld	hl,-6
add	hl,de
call	aslladd
ld	a,(ix+-2)
and	3
ld	l,a
xor	a
ld	h,a
ld	a,l
or	h
jp	nz,l12
ld	e,(ix+6)
ld	d,(ix+7)
ld	hl,8
add	hl,de
ld	e,(hl)
inc	hl
ld	d,(hl)
ld	hl,2
call	wrelop
jp	p,l12
ld	de,1
ld	hl,0
push	hl
push	de
push	ix
pop	de
ld	hl,-6
add	hl,de
call	aslladd
l12:
ld	l,(ix+6)
ld	h,(ix+7)
ld	e,(hl)
inc	hl
ld	d,(hl)
ld	hl,0
push	hl
push	de
ld	de,60
push	hl
push	de
ld	l,(ix+6)
ld	h,(ix+7)
inc	hl
inc	hl
ld	e,(hl)
inc	hl
ld	d,(hl)
ld	hl,0
push	hl
push	de
ld	de,60
push	hl
push	de
ld	l,(ix+6)
ld	h,(ix+7)
inc	hl
inc	hl
inc	hl
inc	hl
ld	e,(hl)
inc	hl
ld	d,(hl)
ld	hl,0
push	hl
push	de
ld	de,24
push	hl
push	de
ld	e,(ix+-6)
ld	d,(ix+-5)
ld	l,(ix+-4)
ld	h,(ix+-3)
call	llmul
call	lladd
call	llmul
call	lladd
call	llmul
call	lladd
jp	cret
