
                        漢字ＲＯＭ不要　日本語表示

                       拡張ＢＡＳＩＣ（アニメカ収録版）

			   ★ ＪＡＰ ｄｉｅｔ ★
				  ver1.00


■ソフト概要

　ご存知の通り、ＭＳＸ２において漢字ＲＯＭはオプション扱いです。従ってＭＳ
Ｘ２汎用のソフトを作るなら、漢字を全く表示しないか、または「漢字ＲＯＭが必
要」と注釈を付けるしかありません。しかし、このソフトを使えば、漢字ＲＯＭを
持たないＭＳＸ２においても日本語を表示することができます（スクリーンモード
は５、６、７、８）。

　ただし、漢字フォントをＶＲＡＭ上に置くので、ＶＲＡＭの消費は覚悟してくだ
さい。フォントは必要なものだけ抽出するので、表示させる文章によってＶＲＡＭ
の消費量は変わります。
　もし第一水準の漢字フォントを全てＶＲＡＭに置くとすると、ＶＲＡＭの半分を
使ってしまうので、ゲームなどＶＲＡＭをたくさん必要とするソフトにおいては実
用的とは言えません。しかし、第一水準の漢字を全て使い切る文章はまずありえま
せん。せいぜい使っても半分程度だと思われます。

　はっきり言ってこのソフトは、漢字ＲＯＭを内蔵または外付けしている機種には
何のメリットもありません。このソフトを使用する意味があるのは、ＭＳＸ２汎用
ソフトを開発する時です。


■各ファイルの概要

　　JAPDIET .DOC	説明書（このファイル）
　　JAPDIET .BIN	拡張ＢＡＳＩＣのためのマシン語プログラム
　　MKFNT   .COM	フォント作成プログラム
　　JPKANAME.FNT	第一水準フォントデータ（12×12ドット）

■使用方法

　１）フォントの作成
　　　　まず、表示させる文章専用のフォントファイルを作成します。つまり、文
　　　章を調べて実際に使われているフォントだけを抽出します。方法は、ＤＯＳ
　　　上で、

　　　　　　　　ＭＫＦＮＴ ﾌｫﾝﾄﾌｧｲﾙ名 ﾃｷｽﾄﾌｧｲﾙ名 ﾃｷｽﾄﾌｧｲﾙ名 ･････ /Sn

　　　と打ちます。“フォントファイル名”とはこれから新たに作成するフォント
　　　ファイルのことです。テキストファイルとは表示させたい文章のことで、複
　　　数指定することができます。
　　　　またこの時、マスターフォントファイル"JPKANAME.FNT"がカレントドライ
　　　ブ（ディレクトリ）になくてはなりません。
　　　　末尾の /Sn はオプションなので、無くても構いません。これを付けると
　　　使用回数が n 以下のフォントを "ﾌｫﾝﾄﾌｧｲﾙ名.COD" というファイルに書き
　　　出します。n は１〜９までです。

　２）ＢＡＳＩＣの拡張
　　　　日本語表示のためのＢＡＳＩＣを拡張します。方法はＢＡＳＩＣ上で、

　　　　　　　　CLEAR 100,&H9000:BLOAD"JAPDIET.BIN",R

　　　を実行します。これで"CALL JAPINI"と"CALL JAPPRT"というＢＡＳＩＣが使
　　　えるようになります。
　　　　ＢＡＳＩＣ領域を広げたい場合は、この後にもう一度 CLEAR 命令を実行
　　　してください。

　３）フォントの読み込み
　　　　ＶＲＡＭにフォントを読み込みます。まずスクリーンモード、ページを設
　　　定して、次の命令を実行します。

　　　　　　　　BLOAD"ﾌｫﾝﾄﾌｧｲﾙ名",S,ｵﾌｾｯﾄ

　　　　オフセットを省略すると画面の一番上から読み込まれます。

　４）ＪＡＰ初期化
　　　　フォント読み込み後、またスクリーンモード変更後には必ず行ってくださ
　　　い。

　　　　　　　　CALL JAPINI(ｱﾄﾞﾚｽ,ﾍﾟｰｼﾞ)

　　　　アドレスとはフォントを読み込んだＶＲＡＭのアドレスです。３）で行っ
　　　た命令の中の“オフセット”がそれに当たります。オフセットを省略した場
　　　合は０になります。
　　　　ページはフォントを読み込んだページ番号です。

　５）表示
　　　　実際に表示します。表示位置は PSET 命令で、色は COLOR 命令で変更で
　　　きます。グラフィック画面に OPEN 命令で文字を表示する時と同じです。

　　　　　　　　CALL JAPPRT("文字列")


■実際の使用例

　表示する文章が "TEST1.TXT" と "TEST2.TXT" に入っているとします。そして、
この文章を SCREEN 7 で表示します。

　まず、ＤＯＳ上で次のコマンドを実行します。

　　　MKFNT TEST.FNT TEST1.TXT TEST2.TXT /S2

　これで "TEST.FNT" というフォントファイルが、
　さらに使用回数を示す "TEST.COD" というテキストファイルが作成されます。
　そして、画面にそれぞれのスクリーンモードで必要なＶＲＡＭの縦ドット数が表
示されます。

　　　SCREEN 5,6 = 087 line
　　　SCREEN 7,8 = 044 line

　今回は SCREEN 7 なので４４ライン必要ということになります。これだと普段は
見えない (0,212)-(511,255) の領域にちょうど収まりますね。
　もっとフォントを減らしたい場合は、"TEST.COD" を見れば、２回以下しか使用
していないフォントが分かるので、それを参考にして文章を修正します。
（オプションで /S2 に設定したので２回以下）

　これで準備ができました。次は実際に表示するための、ＢＡＳＩＣプログラムを
組みます。取敢えず "TEST1.TXT" の文章を１画面ずつ表示するプログラムの例を
示します。

   100 CLEAR 100,&H9000                <--- BASICの拡張
   110 BLOAD"JAPDIET.BIN",R            <
   120 CLEAR 3000,&HD800               <--- BASIC領域を広げる
   130 SCREEN 7                        <--- ｽｸﾘｰﾝﾓｰﾄﾞを設定
   140 SET PAGE ,1                     <--- ﾌｫﾝﾄをﾍﾟｰｼﾞ１の
   150 BLOAD"TEST.FNT",S,256*212       <--- 　(0,212)に読み込む
   160 SET PAGE ,0                     <--- ﾍﾟｰｼﾞを０に戻す
   170 CALL JAPINI(256*212,1)          <--- 初期化,ﾌｫﾝﾄのｱﾄﾞﾚｽ･ﾍﾟｰｼﾞを渡す
   180 OPEN"TEST1.TXT" FOR INPUT AS#1  <--- 文章の入ったﾌｧｲﾙをオープン
   190 FOR J=0 TO 13*15 STEP 13        <--- 一回に１４行表示
   200 PSET(16,J+2),0,TPSET            <--- 表示位置設定
   210 INPUT#1,A$                      <--- １行読み込む
   220 CALL JAPPRT(A$)                 <--- 表示
   230 IF EOF(1)=-1 THEN END           <--- 終了チェック
   240 NEXT J                          <--- 繰り返し
   250 IF INKEY$="" THEN 250           <--- １画面表示後のキー待ち
   260 CLS:GOTO 190                    <--- 画面クリア

　上の例では、文章はテキストファイルから読み込んでいますが、ＢＡＳＩＣプロ
グラムの中に DATA 文で置いても構いません。
　150、170行で指定しているフォントを置くＶＲＡＭのアドレスは次の様な計算で
求められます。

　　　SCREEN 5,6の場合 ： 読み込むＹ座標 × １２８
　　　SCREEN 7,8の場合 ： 読み込むＹ座標 × ２５６


■使用上の注意

　・ＶＲＡＭのフォント領域を破壊しないように注意してください。
　・拡張ＢＡＳＩＣのプログラムは裏ＲＡＭに置かれているので、他の裏ＲＡＭを
　　使う拡張ＢＡＳＩＣは使えません。また、CALL MEMINI も使えません。
　・COLOR n で文字の色を変えることができますが、SCREEN 8 の時は必ず白にな
　　ります。
　・最速で表示するには次の条件を満たしている必要があります。
　　　　表示位置Ｘが、 SCREEN 5,7 で (X AND FEH) 、SCREEN 6 で (X AND FCH)
　　　　TPSETやXOR等の論理演算子を使用しない
　・本ツールで使われている第一水準の漢字は、サンヨーのＷＡＶＹのマニュアル
　　に合わせてありますので、一部他の機種の物と違います。


■転載・配布条件

　・オリジナルのまま、付属のドキュメントを添付すること。
　・無償で配布すること。ただし、送料等の実費の回収は認めます。


■使用に際して

　・市販・同人ソフトに組み込むことは自由ですが、フォント、文字表示ルーチン
　　単体として販売するのは禁止です。

　・本プログラムを使用することによって起きる損害等について、著作者は一切責
　　任を負いませんのでその旨ご了承ください。

　・市販・同人ソフトに組み込む場合
　　本ソフトのフォントは中村隆生氏から提供された物です（ﾌｫﾝﾄ名『要町』）。
　ですので、フォントの著作権は中村氏にあります。中村氏によると、『要町』を
　組み込んだソフトを販売する場合には（同人ソフトであっても）申請が必要との
　ことです。ただし、ライセンスは無償で行ってくれるそうなのでご安心を(^_^)
　プログラムの著作権は私にありますが、こちらは特に申請しなくて結構です。

　　［中村隆生氏の連絡先（勤務先）］

	　〒１７１　東京都豊島区長崎１−２８−２３　Ｍｕｓｅ西池袋２Ｆ
	　株式会社満開製作所　電脳倶楽部編集部　気付

	　NIFTY-Serve：GAH00747（個人ＩＤ）
		       LDB03542（法人ＩＤ）



                                                       きくち きくお
                                                      (MAR'Z PROJECT)
