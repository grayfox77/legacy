
BADSCAN.DOC                                                     92-09-27


       ＜ＭＳＸ−ＤＯＳ　不良クラスター　検出＆登録　プログラム＞

・用途
  ディスクの読取エラーを起こす箇所を発見し、ＦＡＴに登録することにより、
  以後この箇所を使用しないようにします。

・使用方法
  コマンドラインから

A> BADSCAN　Drive:　[/Option]

とします。ドライブは必ず指定してください。

・オプション
  次のようなオプション機能があります。

    /A      開始待ちの状態でＣＡＰランプを点滅させます。
    /C      検査作業中のセクタのカウンタを表示します。
    /L      大容量メディアの場合指定しないとＦＡＴへの登録を行いません。
    /N      エラーセクタを発見してもＦＡＴへの登録は行いません。
    /R      プログラムを終了せずに、再び開始待ちの状態になります。
    /Q      すぐにディスクの検査を開始します。/A /R オプションは無効にな
            ります。

    /Aオプションと/Rオプションを合わせて指定した場合にＣＡＰランプは

    不良クラスタが発見できなかった場合      ０．５秒ずつ明滅する。
    不良クラスタが発見された場合            短く２回明滅し０．５秒消灯す
                                            る。

・エラーメッセージ
  /L option off
  <Warning> Media size is large   /L オプションなしで大きなディスクを検
                                  査したので登録は行いません。
  Disk offline                    ドライブ指定が違います。
  Disk read error (BOOT sector)   ブートセクタが読み込めませんでした。
  Disk read error (FAT)           ディスクのＦＡＴが読み込めませんでした。
  Disk read error (Directory)     ディスクのディレクトリ・エリアが読み込
                                  めません。
  Not enough memory               作業に必要なメモリが足りません。
  Difference between
          FAT1 and FAT2           読み込んだ２つのＦＡＴに相違があります。
  Too much FAT in disk            ＦＡＴが２つより多くあります。
  [ Write protect DISK ]          書き込み禁止のディスクです。
  ???                             特定不能のエラーです。

・動作中の中断について
  検査作業中に
  ESCキーもしくはCtrl+STOP(^C)によって検査作業を中断します。
  Ctrl+STOP(^C)の場合はプログラムそのものを中断します。

＊検査途中に作業を中断した場合にはＦＡＴへの登録は行なわれません。


・発見したエラークラスタについては
  未使用の領域の場合    検査作業終了後にＦＡＴに登録します。
  使用中の領域の場合    発見報告だけをしてＦＡＴに登録は行いません。
  登録済み領域の場合    読取テストそのものを省略します。

    というように処理しています。


・譲渡条件
  このプログラムの、使用、譲渡、改造に制限を設けないと同時に、このプログ
  ラムの使用に伴う結果について原著作者は責任を負わないものとします。改造
  においてはあなたの善意を信頼し、故意に他人に被害を与える行為をしないと
  信じソースコードを公開します。譲渡については、改変の自由の保証のため、
  ソースコードを含む配布を希望します。

・一口メモ
  Ver1.2x
  ＨＢ−Ｆ１ＸＤの内蔵ディスクで２ＤＤを、約１分弱で検査する。ただし全く
  エラーセクタが無かった場合に限る。ＶＲＡＭを利用したＲＡＭディスクでは
  暴走する。ディスクの諸元をブートセクタから読み取っているためかもしれな
  い。ハードディスクなどでは、まだ安全性は未確認。

  Ver1.35
  カウンタの表示のためカーソル消去。発見したエラー・クラスタの使用状況の
  明示。大容量メディアでのオプション指定無しでのＦＡＴ登録の禁止。/Lオプ
  ションで解禁。ブートセクタのないデバイスへの対応。読み込んだセクタ０の
  先頭がＦＡＴの形式だった場合にＢＤＯＳファンクション１Ｂｈを実行。主に
  ＲＡＭディスクを想定。

  Ver1.47
  ブートセクタのあるメディアで、トラックあたりのセクタ数が０の場合に永久
  ループに至ってしまうバグを修整。多数のディレクトリ・エントリーがある大
  容量メディアで、読み込みテスト時にスタックやシステム領域上にオバーライ
  トしてしまう現象への対応。複数のヘッドがあるメディアでの若干の高速化
  （２ＤＤで５％程度）。

  Ver1.49
  使用中のクラスタにエラーがあるとハングアップしてしまうバグの修整。スタ
  ックとバッファの上限との設定の変更。

  Ver1.55
  ＣＡＰランプの動作にエラーがあった場合と無かった場合に違いを持たせた。
  トラックリード前にＦＡＴを読み、無駄なリトライを減少させた。

  Ver1.58
  登録済みのエラーも新たなエラーとしてカウントしてしまい、無意味な登録が
  行なわれていた。バッチファイルのために開始待ちを無効にする /Q オプショ
  ンを追加。

  Ver1.59
  ＦＡＴの登録時に書き込むセクタ数が正しく算出されていないために、ディレ
  クトリ・エントリーが破壊されていた。

                                                          制作：たまむし

