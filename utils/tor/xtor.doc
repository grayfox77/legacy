                        РАСШИРЕННЫЙ
               ТЕКСТОВЫЙ 2-ОКОННЫЙ РЕДАКТОР
                      (10-БУФЕРНЫЙ)

                         XTOR

                         Версия 2

                         MSX/MSX2

                 Руководство пользователя


                       Леонид БАРАЗ


                      В тексте данного документа применяются
                      следующие  обозначения:  в   уголковые
                      скобки < и > берутся  названия  специ-
                      альных  клавиш;  пробелом  разделяются
                      клавиши, которые нужно нажимать после-
                      довательно, а плюсом - одновременно.


     Программа XTOR представляет собой  экранный  текстовый
редактор. Этот редактор может использоваться на ПЭВМ MSX2 и
MSX, оснащенных VDP 9938 ("YAMAHA" YIS503II),  под управле-
нием операционной системы MSX-DOS.

     Команда вызова редактора:
      A> XTor[/V][/d[nnn]][/S[макро]][/Xслово] [файлы ...]

     При наличии флага /V для расширения текстового  буфера
будет  использоваться  вся  имеющаяся  видеопамять,   кроме
первых 16Kбайт (при VRAM 128K размер буфера 136K, при  VRAM
64K - 72K). ВНИМАНИЕ:  Флаг  /V,  как  правило,  не  должен
использоваться  вместе  с  RAM-диском,  так  как  имеющиеся
драйверы обычно используют свободное пространство VRAM  для
своих нужд.
     При  наличии  флага  /d[nnn]  текстовый  буфер   будет
расширен за счет файла XTOR.$$$, автоматически создаваемого
на дисководе d: (размер файла  около  nnn+4  Кбайт,  размер
буфера nnn+24 K; если значение nnn не указано или на  диске
недостаточно места, создается файл  максимально  возможного
размера).  Для  размещения  буферного  файла  рекомендуется
использовать RAM-диск. Если используется гибкий диск, любая
неисправимая  ошибка  при  чтении/записи  буферного   файла
приводит к полной НЕВОЗМОЖНОСТИ продолжения редактирования;
в том числе оказывается невозможным сохранить набранный или
отредактированный текст. Сообщения о сбое буферного файла и
о необходимости установить соответствующий диск в  дисковод
появляются в левом верхнем углу экрана.
     При наличии флага /S[макро] во время запуска редактора
автоматически загружается набор макрокоманд, находящийся  в
файле 'макро' или 'TOR.TOR' (в случае /S без имени файла).
     При  наличии  флага  /Xслово   сразу   устанавливается
кодирующее слово, используемое при загрузке и записи файлов.

     Примеры запуска редактора:
      A> XTor/V *.DOC B:*.TXT
            Это - наиболее часто используемая  конфигурация,
            обеспечивающая  для  MSX2  с  VRAM  128K  размер
            буфера 136K.
      А> XTor/B200
            Запуск редактора с расширением текстового буфера
            на диск B: (размер расширения - 200K).

     Редактор предоставляет пользователю  разнообразные воз-
можности редактирования:
   - набирать, запоминать и корректировать тексты, состоящие
из строк произвольной длины  и  содержащие любые символы,  в
том числе  графические и управляющие;
   - редактировать одновременно от 1 до 10  текстов  (каждый
текст загружается в отдельный  текстовый  буфер);  суммарный
размер текстов ограничен количеством доступной памяти;
   - использовать  при корректировке  разнообразные средства
редактирования: перемещение на символ/слово/строку/страницу,
удаление символа/слова/строки, запоминание строки символов и
включение  ее  в любом месте,  рассечение и склейка строк  и
другие;
   - выполнять простейшее форматирование текста  (оформление
абзацев с выравниванием правого края, центрирование заголов-
ков) как при вводе, так и по готовому тексту;
   - выполнять  поиск  по символьному образцу,  а также кон-
текстную замену с подтверждением и без;
   - устанавливать на экране  два текстовых окна,  каждое из
которых  можно связать со своей частью одного или разных ре-
дактируемых текстов;
   - фиксировать  фрагмент  корректируемого текста  и  затем
удалять,  копировать  или  пересылать  его  на  новое  место
того же или другого буфера  (вместо фрагмента можно скопиро-
вать или переслать содержимое второго окна);
   - работать как в 40-, так и в 80-символьном режиме, неза-
висимо от режима операционной системы;
   - дочитывать в текстовые буфера любые файлы  (целиком или
частично);
   - записывать содержимое каждого текстового буфера на диск
целиком или частично, как во вновь создаваемый файл, так и в
виде дополнения к существующему;
   - не выходя из редактора,  просматривать на экране  фраг-
менты любых файлов,  а также распечатывать их или содержимое
текстовых буферов;
   - устанавливать,  выполнять и корректировать макрокоманды
редактирования;
   - устанавливать текущую дату  и,  при наличии Clock-chip,
текущее время;
   - менять цвета текста, фона,  разделительной и информаци-
онной строк;
   - в любой момент  получать  на экране  краткую информацию
об имеющихся средствах (по нажатию <ctrl>+?).


        1. Редактирование текста

     Текст может редактироваться в режиме вставки и в режиме
замены. Режим вставки устанавливается автоматически при вхо-
де в редактор.  Смена режима происходит  при нажатии клавиши
<ins>.

     Курсор в режиме замены  представляет собой высокий пря-
моугольник,  а в режиме вставки - низкий.  При  этом  внутри
физической строки текста  прямоугольник сплошной,  а при вы-
ходе за ее пределы - незаполненный.  Следует обратить внима-
ние,  что при вводе  новых символов  за пределами физической
строки текста перед новым символом автоматически вставляются
недостающие пробелы.

     Для редактирования текста используются специальные кла-
виши (стрелки, перевод строки и т.д.) и управляющие комбина-
ции клавиш  (с нажатой клавишей  <ctrl>).  При этом  обычное
отождествление клавиш не используется:  например, комбинации
<ret>,  <ctrl>+<ret>,  <ctrl>+M  и  <shift>+<ctrl>+M  -  это
четыре разных указания редактору.  Взамен  сочетания  клавиш
<shift>+<ctrl> можно использовать <ctrl>+<esc>.


        1.1. Перемещение по тексту

<left>,
<right>          - передвижение курсора на один символ.
<ctrl>+<left>,
<ctrl>+<right>   - передвижение курсора на одно слово.
<shift>+<ctrl>+<left>,
<shift>+<ctrl>+<right>
                 - подвижка влево/вправо соответственно; кур-
                   сор сдвигается на один символ в  указанном
                   направлении, а окно  -  на  столько  же  в
                   обратном (таким образом, курсор на  экране
                   остается на месте).

<up>,
<down>           - передвижение курсора на одну строку.
<ctrl>+<up>,
<ctrl>+<down>    - передвижение  курсора   на  одну  страницу
                   (размер  страницы   определяется  размером
                   текущего окна).
<shift>+<ctrl>+<up>,
<shift>+<ctrl>+<down>
                 - подвижка вверх/вниз соответственно; курсор
                   сдвигается на одну строку  в указанном на-
                   правлении, а окно - на столько же в обрат-
                   ном (таким образом, курсор на экране оста-
                   ется на месте).

<ret>            - перевод  строки   (независимо   от  режима
                   вставки/замены).

<ctrl>+<tab>     - установка курсора  на ближайшую справа ко-
                   лонку табуляции  (в тексте никаких измене-
                   ний не происходит).
<shift>+<ctrl>+<tab>
                 - установка курсора  на ближайшую слева  ко-
                   лонку табуляции  (в тексте никаких измене-
                   ний не происходит).

<ctrl>+M         - подвод к строке  с данным номером  (номер
                   запрашивается).
<shift>+<ctrl>+M - подвод к первой строке группы копирования
                   (установленной по <ctrl>+B).
<ctrl>+V         - подвод к первой строке текста.
<shift>+<ctrl>+V - подвод к последней строке текста.

<ctrl>+F         - установка  курсора  на  физический  конец
                   строки.
<shift>+<ctrl>+F - установка курсора на начало строки.

<shift>+<ctrl>+U - запись текущией позиции курсора.
<ctrl>+U         - установка курсора  в  записанную  позицию
                   (текущее положение курсора запоминается и
                   может быть восстановлено  повторным нажа-
                   тием <ctrl>+U).


        1.2. Экранное редактирование

<ret>            - перевод  строки   (независимо   от  режима
                   вставки/замены).
<ctrl>+<ret>     - рассечение и перевод строки  (также  неза-
                   висимо от режима вставки/замены).

<ins>            - смена  режима вставки/замены  на  противо-
                   положный.
<ctrl>+<blank>   - вставка пробела  (при этом курсор остается
                   на прежнем месте).

<tab>            - запись  символа табуляции  (шаг  табуляции
                   пользователь  может  установить  с помощью
                   комбинации клавиш <ctrl>+|).
<stop>           - после этой клавиши  следующий  управляющий
                   символ  записывается,   а  не  исполняется
                   (например,<stop> <ret> или <stop> <ctrl>+M
                   вызовут запись управляющего символа  с ко-
                   дом 0D).
<ctrl>+=         - запись символа по числовому коду  (код за-
                   прашивается).

<ctrl>+[         - преобразование заглавных букв в строчные.
<shift>+<ctrl>+[ - преобразование строчных букв в заглавные.
<ctrl>+]         - преобразование русских букв в латинские.
<shift>+<ctrl>+] - преобразование латинских букв в русские.

<del>            - удаление символа, на котором стоит курсор.
<ctrl>+<del>     - удаление слова, начиная с позиции курсора.
<bs>             - удаление символа влево от позиции курсора.
<ctrl>+<bs>      - удаление слова влево от позиции курсора.

<ctrl>+E         - стирание всех символов  вправо от курсора
                   до конца строки.
<shift>+<ctrl>+E - стирание всех символов  влево  от курсора
                   до начала строки.

<ctrl>+<ins>     - вставка пустой строки перед текущей.
<ctrl>+K         - удаление текущей строки.
<ctrl>+N         - рассечение строки.
<ctrl>+J         - склейка строк.

<ctrl>+Y         - запоминание  символов  строки,  начиная  с
                   позиции курсора (в ответ на запрос о запо-
                   минании символов можно с помощью стрелок и
                   клавиш редактирования установить запомина-
                   емый текст и нажать клавишу  <ret>;  если
                   нажать эту  клавишу  сразу,  запоминаются
                   все символы до конца строки).
<ctrl>+P         - вставка символов, запомненных по <ctrl>+Y.

<ctrl>+C         - восстановление строки:  если  строка была
                   удалена,  она  снова вставляется в текст;
                   если в ней были сделаны изменения, строка
                   в прежнем (до изменений) виде  включается
                   в текст перед измененной строкой. Повтор-
                   ное нажатие <ctrl>+C  убирает  восстанов-
                   ленную строку. Для правильного восстанов-
                   ления  строка  не должна быть длиннее 511
                   символов.


        1.3. Форматирование текста

<ctrl>+L         - форматирование абзаца (в абзац включаются
                   текущая строка  независимо от величины ее
                   левого поля  и  все последующие строки, у
                   которых отступ слева другой).
<shift>+<ctrl>+L - форматирование группы строк  (в интервале
                   строк от <ctrl>+B до <shift>+<ctrl>+B вы-
                   деляются и форматируются абзацы).

<shift>+<ctrl>+Z - центрирование заголовка.

<ctrl>+I         - включение/выключение  режима автоматичес-
                   кого форматирования при вводе.  В 80-сим-
                   вольном режиме  включенный режим формати-
                   рования отмечается строкой разметки внизу
                   экрана.
<shift>+<ctrl>+I - установка параметров форматирования:  по-
                   зиций левого  и  правого края,  отступа в
                   начале абзаца.  Установка параметров  вы-
                   полняется  в 80-символьном режиме.  Теку-
                   щие значения  параметров  отображаются  в
                   строке разметки  внизу экрана.  Изменение
                   параметра, отмеченного курсором, осущест-
                   вляется  стрелками,  а переход  от одного
                   параметра к другому - <ctrl>+стрелками.
                   Включение/выключение автоматического  пе-
                   реноса слов происходит при нажатии клави-
                   ши "минус".
<ctrl>+<         - установка  левого края по текущей позиции
                   курсора.
<ctrl>+>         - установка правого края по текущей позиции
                   курсора.
<ctrl>+\         - установка абзацного  отступа  по  текущей
                   позиции курсора.
<ctrl>+-         - включение/выключение автоматического  пе-
                   реноса слов.

     При автоматическом форматировании вводимого текста:
- ввод символа  правее установленного правого края  вызывает
  перенос лишних символов на новую строку (рассечение выпол-
  няется  по пробелу между словами или путем переноса слова,
  правый край автоматически выравнивается);
- перевод строки <ret> воспринимается как признак завершения
  текущего абзаца и начало нового;  текущая строка не вырав-
  нивается; курсор устанавливается в позицию отступа при на-
  чале абзаца в следующей строке.


        1.4. Управляющие клавиши для поиска и замены

<ctrl>+S         - поиск образца  вперед  по тексту  (образец
                   запрашивается).
<ctrl>+T         - поиск образца  назад  по  тексту  (образец
                   запрашивается).
<ctrl>+Q         - продолжение поиска в прежнем направлении.

<ctrl>+X         - контекстная замена (запрашивается образец,
                   заменяющая строка и режим: с подтверждени-
                   ем или без).

<shift>+<ctrl>+S,
<shift>+<ctrl>+T,
<shift>+<ctrl>+Q,
<shift>+<ctrl>+X - имеют  тот же  смысл,  но  образец  ищется
                   только в начале слов (каждое слово состоит
                   из "однородных" символов:  букв/цифр, гра-
                   фических, управляющих и т.п.).

     При двукратном нажатии  любой из этих клавиш  поиск  или
контекстная замена будет выполняться во всех буферах.

     Ввод образца поиска и строки замены  заканчивается нажа-
тием клавиши <ret>.

     В образце поиска и в строке замены  можно указывать при-
знак произвольного символа <ctrl>+?. При поиске ему может со-
поставляться произвольный символ,  а при замене  на его месте
остается символ из найденного образца  (или пробел,  если за-
меняющая строка длиннее образца поиска).

     В строке образца и/или замены  можно  указывать  признак
новой строки; он задается клавишами <ctrl>+<ret>.

     В строку образца или замены можно вставить символы,  за-
помненные по <ctrl>+Y. Для этого нужно нажать <ctrl>+P.

     Если при поиске  вперед(назад)  происходит выход  на по-
следнюю(первую)  строку,  на экран выдается сообщение,  и по-
иск продолжается с первой(последней) строки.

     Поиск или замену можно прервать, нажав <ctrl>+<stop>.


        1.5. Управляющие клавиши для групповых действий

<ctrl>+B         - пометка текущей строки  как первой строки
                   группы копирования.
<shift>+<ctrl>+B - пометка  текущей  строки   как  последней
                   строки группы копирования.
                   На экране  в 80-символьном  режиме строки
                   группы копирования  выделяются  цветом  в
                   первой позиции.
<shift>+<ctrl>+M - подвод к первой строке группы копирования
                   (установленной по <ctrl>+B).

<ctrl>+G         - копирование  группы  строк  (начальная  и
                   конечная строки устанавливаются с помощью
                   <ctrl>+B   и   <shift>+<ctrl>+B). Текущая
                   строка может входить  в состав копируемой
                   группы.
<shift>+<ctrl>+G - копирование фонового окна (выполняется так
                   же,  как и <ctrl>+G,  но копируются строки
                   фонового окна).

<ctrl>+H         - пересылка группы строк  (выполняется  так
                   же, как и <ctrl>+G,  но копируемая группа
                   строк на старом месте уничтожается).
<shift>+<ctrl>+H - пересылка фонового окна  (выполняется  так
                   же, как и <ctrl>+H, но пересылаются строки
                   фонового окна).

<shift>+<ctrl>+K - удаление группы строк (начальная и конеч-
                   ная  строки  устанавливаются   с  помощью
                   <ctrl>+B и <shift>+<ctrl>+B; перед удале-
                   нием запрашивается подтверждение).


        2. Использование текстовых буферов

     Каждый редактируемый текст  располагается  в одном из 10
текстовых буферов. Буфера нумеруются цифрами от 0 до 9.  Кла-
виши управления буферами приведены ниже.

<ctrl>+U         - смена текущего буфера (номер буфера запра-
                   шивается).

<ctrl>+R         - переход к следующему буферу  (с номером на
                   1 больше).

<shift>+<ctrl>+R - переход к предыдущему буферу (с номером на
                   1 меньше).

<ctrl>+D         - просмотр информации обо всех буферах;  для
                   каждого буфера указываются номер последней
                   строки,   ориентировочный  размер  текста,
                   признак  модификации  и  имя  стандартного
                   файла;  для буфера,  в  котором  находится
                   группа строк для копирования,  указываются
                   также  номера  первой  и  последней  строк
                   группы.
                   Нажав после просмотра одну из клавиш  0-9,
                   можно перейти в соответствующий буфер (как
                   по <ctrl>+U).


        3. Использование окон

     На экране  редактор организует  два текстовых окна с ин-
формационными строками  и  строку запросов/сообщений. Клавиши
управления окнами приведены ниже.

     Курсор  выставляется  только  в одном из текстовых окон;
оно считается основным, а второе окно - фоновым.

     Информационная строка каждого окна указывает номер буфе-
ра, с которым связано данное окно, стандартное имя файла это-
го буфера,  номер текущей строки, номер последней строки, но-
мер текущей позиции и номер начальной строки окна. Для основ-
ного окна, в котором находится курсор, в информационную стро-
ку также заносится размер остатка свободной памяти, код теку-
щего символа и номера буфера, первой и последней строк группы
копирования, если она установлена.

     Строка запросов/сообщений  содержит текущую дату и,  при
наличии Clock-chip,  текущее время.  В этой строке появляются
все сообщения и запросы редактора.

     Информационные строки и строка запросов/сообщений  в 80-
символьном режиме выделяются цветом. Все четыре цвета (симво-
лов и фона для текста и для строк)  можно менять во время ра-
боты редактора. При этом  первые два параметра команды  COLOR
задают цвета символов и фона для текста,  а третий параметр -
цвет фона информационных строк и строки запросов/сообщений.

     Если одно из окон не содержит строк текста, его информа-
ционная строка на экране не отображается. В начале работы ре-
дактора верхнее текстовое окно  не содержит строк и на экране
отсутствует.

<ctrl>+O         - сдвиг границы окон вверх.
<ctrl>+<shift>+O - сдвиг границы окон вниз.

<ctrl>+W         - переход в другое окно.

<ctrl>+Z         - центрирование основного окна (курсор оста-
                   ется  в прежней  позиции  текста,  а  окно
                   устанавливается так,  чтобы курсор оказал-
                   ся как можно ближе к центру окна).

<ctrl>+A         - согласование  окон  (номер  первой  строки
                   фонового окна устанавливается  равным  но-
                   меру первой строки основного окна).

<home>           - подвод курсора к первой строке окна.
<cls> (т.е.<ctrl>+<home>)
                 - подвод курсора к последней строке окна.

<shift>+<ctrl>+G - копирование фонового окна (выполняется так
                   же,  как и <ctrl>+G,  но копируются строки
                   фонового окна).

<shift>+<ctrl>+H - пересылка фонового окна  (выполняется  так
                   же, как и <ctrl>+H, но пересылаются строки
                   фонового окна).


        4. Настройка

<esc>            - выход в режим команд, связанных с файлами.

<select>         - установка 40- и 80-символьного режима.

<ctrl>+<stop>    - включение/выключение  отображения управля-
                   ющих символов.

<ctrl>+|         - установка нового шага табуляции  (значение
                   шага запрашивается); первоначально устано-
                   влено  значение 8.

<ctrl>+*         - установка даты, времени и цветов (символов
                   и фона для текста и информационных строк);
                   стрелки  влево и вправо  позволяют выбрать
                   одно  из полей  для изменения,  а  стрелки
                   вверх и вниз - менять  значение выбранного
                   поля.


        5. Макрокоманды

     Последовательность нажатых клавиш  может быть  оформлена
в виде макрокоманды. Всего имеется  10  макрокоманд,  которые
обозначаются цифрами от 0 до 9.

     Чтобы  начать  формирование  макрокоманды,  надо  нажать
клавиши <shift>+<ctrl>+цифра, и затем выполнить все действия,
включаемые  в   макрокоманду.   Количество   действий   (т.е.
управляющих или обычных клавиш) в макрокоманде не может  быть
больше 64. Результат выполнения этих  действий,  как  обычно,
виден на экране.

     Формирование  макрокоманды  заканчивается  при   нажатии
<ctrl>+@. С помощью <ctrl>+@ можно также посмотреть  значения
всех макрокоманд. После того, как текущие  значения  макроко-
манд будут выданы на экран, можно нажать одну из клавиш 0-9 и
войти в режим  редактирования  соответствующей  макрокоманды.
Редактирование осуществляется аналогично вводу образца  поис-
ка. Для записи управляющих клавиш перед ними необходимо нажи-
мать <stop>.

     Для вызова макрокоманды нужно нажать  <ctrl>+цифра.  При
этом  все  записанные при формировании  действия  выполняются
так,  как если бы в этот момент  были нажаты  соответствующие
клавиши.

     Значения макрокоманд можно запоминать на диск  и  считы-
вать с диска (см. раздел 6.)


        6. Работа с файлами

     После нажатия клавиши <esc>  на экране  появляется  меню
команд, связанных с файлами. Имеются следующие команды:

      L - Загрузка текста из файла в текущий буфер
<esc> L - Загрузка текстов из файлов в пустые буфера  (эта же
          команда выполняется автоматически  при запуске  ре-
          дактора)
      S - Сохранение текста из текущего буфера в файле
<esc> S - Сохранение всех измененных текстов в файлах
      A - Дописывание текста из текущего буфера к файлу

      T - Выдача файла(файлов) на экран
      P - Распечатка файла(файлов) или буфера(буферов)

      D - Просмотр оглавления диска
      K - Удаление файла(файлов)
      R - Переименование файла(файлов)
      N - Выбор  нового  имени  стандартного  файла  текущего
          буфера

      X - Установка слова для кодировки при загрузке и записи
          текстов

      I - Загрузка значений макрокоманд из файла
      J - Сохранение значений макрокоманд в файле

      C - Очистка текущего текстового буфера
<esc> C - Очистка всех текстовых буферов
      Q - Завершение работы редактора

     Во  всех  командах  для выполнения  требуемого  действия
по умолчанию предлагается некоторая спецификация (простое или
обобщенное имя файла). Чтобы использовать его, достаточно на-
жать <ret>. Взамен можно задать любое имя файла или несколько
имен,  которые будут использоваться при выполнении данной ко-
манды.

     При загрузке текста в пустой буфер  имя файла  запомина-
ется  в качестве стандартного  для этого буфера.  Стандартное
имя в дальнейшем предлагается по умолчанию при выполнении ко-
манд записи (S, <esc> S, C, <esc> C, Q).  Стандартное имя мо-
жет быть изменено только командами S и N, a отменено - коман-
дами C и <esc> C.

     Стандартные имена файлов  для буферов  первоначально бе-
рутся  из команды запуска редактора.  Эти файлы автоматически
загружаются в процессе запуска. Их может быть от 0 до 9.

  Команды  C и <esc> C  отменяют  прежнее стандартное имя,  и
после этого имя файла из первой же команды L становится новым
стандартным.  Стандартное имя может быть изменено командой N.
Оно изменяется  также  при записи текста целиком  в некоторый
файл.

     По командам  Q, C и <esc> C  перед выполнением их основ-
ного действия  выполняется  проверка,  внесены ли изменения в
загруженные тексты. Если изменения были внесены, пользователю
предоставляется  возможность  сохранить  тексты в стандартных
файлах соответствующих буферов.

     В командах <esc> L, <esc> S, <esc> C, Q, T, P, K, R име-
ются режимы с подтверждением и без. В режиме с подтверждением
для каждого файла или текста в буфере выдается запрос, на ко-
торый  можно ответить Д(да)/Y(yes),Н(нет)/N(no),В(все)/G(go).
Чтобы прервать работу, нужно нажать <ctrl>+<stop>.

     При  просмотре и распечатке для прекращения выдачи нужно
нажать <ctrl>+<stop>,  а для временной приостановки  -  любую
другую клавишу  (выдача возобновляется при нажатии любой кла-
виши).

     Файлы, которые загружаются или записываются на диск, мо-
гут автоматически кодироваться некоторым  словом.  Это  слово
задается командой X.

     Некоторые  удобные  последовательности команд  работы  с
файлами  закреплены  за  функциональными клавишами.  Значения
функциональных клавиш  выдаются  на экран  вместе  со списком
команд после нажатия клавиши <esc>.
