;*************************************************************
; SCREEN12 CLEARING          (C)JP3TLC , TLC   1996
;*************************************************************

	ORG	0100H

;>>>>>Ã²½³¾¯Ä

SETDMA	EQU	1AH
STROUT	EQU	09H
SFIRST	EQU	11H
FOPEN	EQU	0FH
FDEL	EQU	13H
FMAKE	EQU	16H
FCLOSE	EQU	10H
RDBLK	EQU	27H
WRBLK	EQU	26H
LOGIN	EQU	18H
ALLOC	EQU	1BH
CR	EQU	0DH
LF	EQU	0AH
BS	EQU	08H
BEEP	EQU	07H

BDOS	EQU	0005H
DMA	EQU	0080H
FCB	EQU	005CH
CALSLT	EQU	001CH
CALLF	EQU	0030H
RDSLT	EQU	000CH
EXTROM	EQU	015FH
REDCLK	EQU	01F5H
EXBRSA	EQU	0FAF8H
VDPSTA	EQU	0131H
WRTVDP	EQU	012DH
ENASLT	EQU	0024H
RSLREG	EQU	0138H
EXTBIO	EQU	0FFCAH

DAC	EQU	0F7F6H
ARG	EQU	0F847H
VALTYP	EQU	0F663H
FRCDBL	EQU	303AH
FRCINT	EQU	2F8AH
DECADD	EQU	269AH
DECSUB	EQU	268CH
DECDIV	EQU	289FH
DECMUL	EQU	27E6H
EXPTBL	EQU	0FCC1H
ICOMP	EQU	2F4DH
MAF	EQU	2C4DH
MMF	EQU	2C67H
MAM	EQU	2C50H
PHF	EQU	2CCCH
PPA	EQU	2CDCH
FOUT	EQU	3425H
PUFOUT	EQU	3426H
VMOVMF	EQU	2F10H
VMOVAM	EQU	2EEFH
FOUTH	EQU	3722H
SLTTBL	EQU	0FCC5H
ISUB	EQU	3167H
UMULT	EQU	314AH
IADD	EQU	3172H
IMULT	EQU	3193H
IDIV	EQU	31E6H

;>>>>>À²ÄÙ Ë®³¼Þ

	LD	DE,MES1
	LD	C,STROUT
	CALL	BDOS

;>>>>>USAGE Ë®³¼Þ

	LD	DE,MES2
	LD	A,(DMA)
	OR	A
	JP	Z,LAB2

;>>>>>WKFCB1,WKFCB2 É ¸Ø±

	LD	HL,WKFCB1
	LD	DE,WKFCB1+1
	LD	BC,37+37-1
	LD	A,0
	LD	(HL),A
	LDIR

;>>>>>¶¸Á®³¼ Ñ¼Ã² É ÊÞ±² SCC Æ ½Ù

	LD	HL,FCB+9
	LD	A,(HL)
	CP	' '
	JP	NZ,LAB53
	LD	HL,WKEXT	
	LD	DE,FCB+9
	LD	BC,3
	LDIR

;>>>>>ËÄÂÒ É Êß×Ò°À¦ WKFCB1,WKFCB2 Æ ²ÚÙ

LAB53:	LD	HL,FCB
	LD	DE,WKFCB1
	LD	BC,12
	LDIR

	LD	HL,FCB
	LD	DE,WKFCB2
	LD	BC,12
	LDIR

;>>>>>:¦ »¶Þ¼ ÄÞ×²ÌÞÒ²¦ WKFCB2 Æ ²ÚÙ

	LD	HL,0080H
	LD	B,(HL)
	LD	A,':'
LAB71:	INC	HL
	CP	(HL)
	JP	Z,LAB73
	DJNZ	LAB71
	LD	A,0
	JP	LAB72
LAB73:	DEC	HL
	LD	A,(HL)
LAB72:	LD	(WKFCB2),A

;>>>>>/J ¦ »¶Þ¼ Êß×Ò°À¦ WKPRMJÆ ²ÚÙ

	LD	IX,0080H
	LD	B,(IX+0)
LAB74:	INC	IX
	LD	A,'/'
	CP	(IX+0)
	JP	Z,LAB75
LAB77:	DJNZ	LAB74
	JP	LABNK
LAB75:	LD	A,'J'
	CP	(IX+1)
	JP	Z,LAB78
	LD	A,'j'
	CP	(IX+1)
	JP	Z,LAB78
	JP	LAB77
LAB78:	LD	A,(IX+2)
	CP	'-'
	JP	Z,LAB79
	SUB	30H
	JP	LAB76
LAB79:	LD	A,(IX+3)
	SUB	30H
	LD	B,A
	LD	A,0
	SUB	B	
LAB76:	LD	(WKPRMJ),A

;>>>>>/K¦ »¶Þ¼ WKPRMK Æ ²ÚÙ

LABNK:	LD	IX,0080H
	LD	B,(IX+0)
LAB64:	INC	IX
	LD	A,'/'
	CP	(IX+0)
	JP	Z,LAB65
LAB67:	DJNZ	LAB64
	JP	LABN
LAB65:	LD	A,'K'
	CP	(IX+1)
	JP	Z,LAB68
	LD	A,'k'
	CP	(IX+1)
	JP	Z,LAB68
	JP	LAB67
LAB68:	LD	A,(IX+2)
	CP	'-'
	JP	Z,LAB69
	SUB	30H
	JP	LAB66
LAB69:	LD	A,(IX+3)
	SUB	30H
	LD	B,A
	LD	A,0
	SUB	B	
LAB66:	LD	(WKPRMK),A

;>>>>>¶·ÀÞ½Ì§²ÙÒ² É ÏÂËÞÆ -¦ Â¹Ù

LABN:	LD	B,8
	LD	HL,WKFCB2+1
LAB50:	LD	A,(HL)
	CP	' '
	JP	Z,LAB51
	INC	HL
	DJNZ	LAB50
	DEC	HL
	LD	A,'-'
	CP	(HL)
	JR	NZ,LAB51
	LD	(HL),'1'
	JR	LABDST
LAB51:	LD	(HL),'-'

;>>>>>Êß×Ò°À Æ Ü²ÙÄÞ¶°ÄÞ ¼Ã² Ê ´×°

LABDST:	LD	DE,MES3
	LD	HL,FCB
	LD	A,'?'
	LD	B,12
LAB1:	CP	(HL)
	JP	Z,LAB2
	INC	HL
	DJNZ	LAB1

;>>>>>WKDMA¾¯Ã²

	LD	DE,WKDMA
	LD	C,SETDMA
	CALL	BDOS

;>>>>>LOGIN VECTOR Áª¯¸

	LD	C,LOGIN
	CALL	BDOS
	LD	DE,MES4
	LD	H,L

	LD	A,(WKFCB1)
	OR	A
	JP	Z,LAB3
	LD	B,A
LAB4:	RR	L
	DJNZ	LAB4
	JP	NC,LAB2

LAB3:	LD	A,(WKFCB2)
	OR	A
	JP	Z,LAB5
	LD	B,A
LAB6:	RR	H
	DJNZ	LAB6
	JP	NC,LAB2

;>>>>>ÖÐºÑÌ§²Ù¦»¶Þ¼,±ÚÊÞOPEN(Å¹ÚÊÞ´×°)

LAB5:	LD	DE,WKFCB1
	LD	C,SFIRST
	CALL	BDOS
	OR	A
	LD	DE,MES5
	JP	NZ,LAB2

	LD	DE,WKFCB1
	LD	C,FOPEN
	CALL	BDOS
	LD	DE,MES6
	OR	A
	JP	NZ,LAB2

;>>>>>WKFCB1(Æ­³Ø®¸Ì§²Ù ÖÐºÐ¼Þ­ÝËÞ)¾¯Ä

	LD	HL,1
	LD	(WKFCB1+14),HL
	DEC	HL
	LD	(WKFCB1+33),HL
	LD	(WKFCB1+35),HL

;>>>>>Í¯ÀÞÉ ÖÐºÐ

	LD	HL,0007H
	LD	DE,WKFCB1
	LD	C,RDBLK
	CALL	BDOS

;>>>>>Í¯ÀÞÉ ¹²¼·Áª¯¸

	LD	HL,WKDMA
	LD	DE,WKHDR
	LD	B,7
LAB7:	LD	A,(DE)
	CP	(HL)
	JP	NZ,LAB17
	INC	HL
	INC	DE
	DJNZ	LAB7

;>>>>>Y É »²ÀÞ²Ä »²¼®³¦ ¼×ÍÞÙ 

	LD	HL,0D3FFH
	LD	(WKCNT),HL

LAB15:	LD	HL,0400H
	LD	DE,WKFCB1
	LD	C,RDBLK
	CALL	BDOS
	PUSH	AF
	PUSH	HL
	POP	BC

	LD	DE,WKDMA
LAB9:	LD	A,B
	OR	C
	JP	Z,LAB14

	LD	HL,(WKCNT)
	LD	A,H
	OR	L
	JP	Z,LAB40
	DEC	HL
	LD	(WKCNT),HL
;YÉ »²ÀÞ² »²¼®³ ¼×ÍÞ
	LD	A,(DE)
	SRL	A
	SRL	A
	SRL	A
	LD	HL,WKLRGY
	CP	(HL)
	CALL	NC,LAB10
	LD	HL,WKSMLY
	CP	(HL)
	CALL	C,LAB11

LAB40:	INC	DE
	DEC	BC
	JP	LAB9

LAB14:	POP	AF
	OR	A
	JP	Z,LAB15

;>>>>>Ì§²Ù¸Û°½Þ

	LD	DE,WKFCB1
	LD	C,FCLOSE
	CALL	BDOS

;>>>>>YÉ »²ÀÞ²Ä »²¼®³ É »

	OR	A
	LD	HL,(WKLRGY)
	LD	DE,(WKSMLY)
	SBC	HL,DE
	LD	(WKDIFY),HL

;>>>>>WKFCB1¦ ¸Ø±

	LD	HL,WKFCB1
	LD	DE,WKFCB1+1
	LD	BC,37-1
	LD	A,0
	LD	(HL),A
	LDIR

;>>>>>WKFCB1¦¾¯Ä

	LD	HL,FCB
	LD	DE,WKFCB1
	LD	BC,12
	LDIR

;>>>>>ÖÐºÑÌ§²Ù¦Ó³²ÁÄÞOPEN

	LD	DE,WKFCB1
	LD	C,SFIRST
	CALL	BDOS

	LD	DE,WKFCB1
	LD	C,FOPEN
	CALL	BDOS

;>>>>>¶·ºÐÌ§²ÙOPEN

	LD	DE,WKFCB2
	LD	C,SFIRST
	CALL	BDOS
	OR	A
	JP	NZ,LAB21

	LD	DE,WKFCB2
	LD	C,FDEL
	CALL	BDOS
	LD	DE,MES9
	OR	A
	JP	NZ,LAB2

LAB21:	LD	DE,WKFCB2
	LD	C,FMAKE
	CALL	BDOS
	LD	DE,MES9
	OR	A
	JP	NZ,LAB2
	LD	DE,WKFCB2
	LD	C,FOPEN
	LD	DE,MES9
	OR	A
	JP	NZ,LAB2	

;>>>>>WKFCB1,WKFCB2¾¯Ä

	LD	HL,1
	LD	(WKFCB1+14),HL
	LD	(WKFCB2+14),HL
	DEC	HL
	LD	(WKFCB1+33),HL
	LD	(WKFCB1+35),HL
	LD	(WKFCB2+33),HL
	LD	(WKFCB2+35),HL

;>>>>>Í¯ÀÞÉ ÖÐºÐ

	LD	HL,0007H
	LD	DE,WKFCB1
	LD	C,RDBLK
	CALL	BDOS

;>>>>>Í¯ÀÞÉ ¶·ºÐ

	LD	DE,WKFCB2
	LD	C,WRBLK
	CALL	BDOS
	LD	DE,MES9
	OR	A
	JP	NZ,LAB30

	PUSH	DE
	LD	DE,WKFCB2
	LD	C,FCLOSE
	CALL	BDOS
	POP	DE

;>>>>>ÎÝÀ²É ÖÐºÐ

LAB60:	LD	HL,0400H
	LD	DE,WKFCB1
	LD	C,RDBLK
	CALL	BDOS
	PUSH	AF
	PUSH	HL
	PUSH	HL
	POP	BC

;>>>>>1ÌÞÛ¯¸¦ ºÝÊÞ°Ä

	LD	DE,WKDMA
LAB61:	LD	A,B
	OR	C
	JP	Z,LAB62
	LD	A,(DE)
	PUSH	DE
	PUSH	BC
;Y
	PUSH	AF
	SRL	A
	SRL	A
	SRL	A
	LD	L,A
	LD	H,0
	LD	DE,(WKSMLY)
	OR	A	
	SBC	HL,DE
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	LD	DE,(WKDIFY)
	LD	C,255
LAB80:	INC	C
	OR	A
	SBC	HL,DE
	JP	NC,LAB80
	LD	A,31
	CP	C
	JP	NC,LAB70
	LD	C,31
LAB70:	SLA	C
	SLA	C
	SLA	C
	LD	A,C
	AND	128+64+32+16+8
	LD	C,A
	POP	AF
	AND	1+2+4
	OR	C
	POP	BC
	POP	DE
	LD	(DE),A
;J & K
	LD	A,C
	DEC	A
	AND	3
	CP	3
	JP	Z,LABK
	CP	1
	JP	Z,LABJ

LABJK:	INC	DE
	DEC	BC
	JP	LAB61

;>>>>>KÍÝ¶Ý Ò²Ý

LABK:	PUSH	DE
	POP	IX

	LD	A,(IX+1)
	AND	1+2+4
	SLA	A
	SLA	A
	SLA	A
	BIT	5,A
	CALL	Z,LABKC1
	LD	L,A

	LD	A,(IX+0)
	AND	1+2+4
	OR	L

	LD	HL,WKPRMK
	ADD	A,(HL)
	CP	-50
	JP	C,LABK10
	CP	32
	CALL	NC,LABKC2
	JP	LABK11

LABK10:	CP	-33
	CALL	NC,LABKC3

LABK11:	PUSH	AF
	AND	1+2+4
	LD	H,A
	LD	A,(IX+0)
	AND	128+64+32+16+8
	OR	H
	LD	(IX+0),A
	POP	AF
	AND	32+16+8
	SRL	A
	SRL	A
	SRL	A
	LD	H,A
	LD	A,(IX+1)
	AND	128+64+32+16+8
	OR	H
	LD	(IX+1),A
	JP	LABJK

LABKC3:	LD	A,-32
	RET
LABKC2:	LD	A,31
	RET
LABKC1:	OR	128+64
	RET

;>>>>>JÍÝ¶Ý Ò²Ý

LABJ:	PUSH	DE
	POP	IX

	LD	A,(IX+1)
	AND	1+2+4
	SLA	A
	SLA	A
	SLA	A
	BIT	5,A
	CALL	Z,LABJC1
	LD	L,A

	LD	A,(IX+0)
	AND	1+2+4
	OR	L

	LD	HL,WKPRMJ
	ADD	A,(HL)
	CP	-50
	JP	C,LABJ10
	CP	32
	CALL	NC,LABJC2
	JP	LABJ11

LABJ10:	CP	-33
	CALL	NC,LABJC3

LABJ11:	PUSH	AF
	AND	1+2+4
	LD	H,A
	LD	A,(IX+0)
	AND	128+64+32+16+8
	OR	H
	LD	(IX+0),A
	POP	AF
	AND	32+16+8
	SRL	A
	SRL	A
	SRL	A
	LD	H,A
	LD	A,(IX+1)
	AND	128+64+32+16+8
	OR	H
	LD	(IX+1),A
	JP	LABJK

LABJC3:	LD	A,-32
	RET
LABJC2:	LD	A,31
	RET
LABJC1:	OR	128+64
	RET

;>>>>>¶·ºÐ

LAB62:	POP	HL
	LD	DE,WKFCB2
	LD	C,WRBLK
	CALL	BDOS
	LD	DE,MES9
	OR	A
	JP	NZ,LAB30

	POP	AF
	OR	A
	JP	Z,LAB60

	LD	DE,MES10

;>>>>>(·®³¾² ¼­³Ø®³)Ì§²Ù¸Û°½Þ

LAB30:	PUSH	DE
	LD	DE,WKFCB2
	LD	C,FCLOSE
	CALL	BDOS
	POP	DE

;>>>>>±ÍÞÝÄÞ+É°ÏÙ´ÝÄÞ

LAB2:	LD	C,STROUT
	CALL	BDOS

	RET

;>>>>>Í¯ÀÞ´×°

LAB17:	LD	DE,MES7
	JP	LAB2

;>>>>>¶ÚÝÄ »²¼®³Á ²Ú¶´(»ÌÞ)

LAB11:	LD	(HL),A
	RET

;>>>>>¶ÚÝÄ »²ÀÞ²Á ²Ú¶´(»ÌÞ)

LAB10:	LD	(HL),A
	RET

;>>>>>ÃÞ°À´Ø±

MES1:	DEFB	CR,LF
	DEFM	'CLEARING SCREEN12 ver1.00  (C)JP3TLC , TLC'
	DEFB	CR,LF,CR,LF,'$'
MES2:	DEFM	'USAGE: SC12CLR inputfile [drive name][/K-9~9][/J-9~9]'
	DEFB	CR,LF,CR,LF,'$'
MES3:	DEFM	'ERROR: Wild card cannot be used.'
	DEFB	CR,LF,'$'
MES4:	DEFM	'ERROR: Invalid drive specification.'
	DEFB	CR,LF,'$'
MES5:	DEFM	'ERROR: File not 