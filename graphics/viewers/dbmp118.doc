
＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃
＃    　　　　　　　　　　　　　　　　　　　　＃
＃　　　Deca BMP loader ver1.18  　　　　 　　＃
＃　　　　 For MSX2+/turboR & MSX-DOS2 　　 　＃
＃ 　　　　　　　　　　　　　　　　　　　   　＃
＃　　　　　　　　　　　By　Ａ ｔｏ Ｃ　　　　＃
＃　　　　　　　　　　　　　　　　　　　　　　＃
＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃



１．概要

　主に４００ラインを超えるＢＭＰフォーマットの画像を鑑賞するためのソフトです。
横のドット数が５１２（SCREEN 5･8は２５６）を超える画像には横スクロールすること
で対応します。その代わり、画像の大きさに応じたマッパーＲＡＭを必要とします。
　また、他機種の画像は縦に引き延ばして表示します。ドットを間引かないので元絵に
近い表示が出来ます。更にタイマ割り込みを使った高忠実度色再現を行うモードもあり
ます。
　おまけとして、ＭＡＧフォーマットへの変換機能・ベタセーブ機能が付いています。

＊対応フォーマット
　ＢＭＰ（非圧縮、２色・１６色・２５６色）



２．必要とする環境

　MSX2+以降の機種で、MSX-DOS2を搭載しており、空きマッパーが16Kbytes以上あること
が動作条件となります。
　必要なマッパーＲＡＭの大きさは画像に応じて変化します。例えば、１６色６４０＊
４００の画像をロードするには125Kbytes（８枚）の空きマッパーが必要になります。８
００ラインの場合、この２倍のマッパーＲＡＭ（１６枚）を使います。
　２色画像は１６色に変換して表示している為、ファイルサイズの約４倍のマッパーＲ
ＡＭが必要です（１６色・２５６色ではファイルサイズとほぼ同じ大きさ）。
　また、ＭＡＧへの変換時、ＭＡＧのピクセルサイズが128Kbytesを越える場合には中間
ファイルをカレントディレクトリに作成します。



３．起動の方法

　DOSのコマンドライン上で

　　DBMP [PATH NAME] /[OPTION]

とすることにより、[PATH NAME]で指定されたディレクトリ、ファイルを読みこんで表示
します。[PATH NAME]にはワイルドカード（*･?）が使えます。ロードするのにマッパー
ＲＡＭの空きが足りないときは、読めた分だけ表示します（このとき、画面がフラッシ
ュします）。
　オプションには次のような物があり、コマンドラインの左から解釈されます。また、
大文字と小文字を区別しません。

    /Kxx　　キーウェイトの大きさを1/60秒単位で設定します。初期値は１です。

    /Rxx　　キースキャンのリピートカウントを設定します。初期値は３０です。/Kxx
            で設定した値と/Rxxで設定した値との積がリピートタイムとなります。

    /H      隠しファイル・システムファイルを検索するモードになります。２回指定
　　　　　　すると検索しないモードになります。

    /S      オートスクロールモードになります。２回指定すると元のモードに戻りま
　　　　　　す。

    /P　　　ＲＧＢ各１５段階の３３７５色中１６色で表示するモードになります。２
　　　　　　回指定すると５１２色中１６色のモードになります。

    /F　　　ＲＧ各１５段階Ｂ７段階の１５７５色中２５６色で表示するモードになり
　　　　　　ます。２回指定するとデジタル２５６色モードになります。
　　　　　　画面の縦引き延ばしを行いません。通常の２倍のメモリを必要とします。

    /E　　　ＲＧ各１５段階Ｂ７段階の１５７５色中２５６色で表示するモードになり
　　　　　　ます。２回指定するとデジタル２５６色モードになります。
　　　　　　画面の縦引き延ばしを行います。通常の２.５倍のメモリを必要とします。

    /G　　　DBMP.COMを終了するとき、テキストモードに戻りません。MM.COMから子プ
            ロ起動した場合の復帰を迅速に行う為のオプションです。コマンドライン
　　　　　　から起動する場合は使用しないでください。無指定・２回指定の時はテキ
　　　　　　ストモードに戻ります。

    /L　　　２００ラインフラグをセットします。無指定・２回指定でリセットされま
　　　　　　す。

    /Y　　　他機種の画像を縦方向に引き延しません。無指定・２回指定の時は引き延
　　　　　　ばします。

    /X　　　１６色画像をSCREEN 5で表示します。無指定・２回指定の時はSCREEN 7で
            表示します。

    /D　　　２５６色画像を表示するとき，ＢＭＰファイルに設定されたパレットを使
　　　　　　用しません。無指定・２回指定の時は使用します。他機種の２５６色画像
　　　　　　を再セーブするときは必ず指定してください。

    /T      複合ロードモードになります。このモードに入ると、読み込んだファイル
　　　　　　をクリアせず、次に読み込んだファイルが追加されていきます。

    /C　　　表示されたファイルを自動的に再セーブするモードになります。変換をキ
　　　　　　ャンセルしたい時はESCキーを押し放しにしてください。２回指定するとモ
            ードを解除します。

    /?　　  簡単なヘルプメッセージを表示します。



例）

A>DBMP /K0R25000
カレントドライブ（この場合はＡドライブ）のカレントディレクトリにある全ての[.BMP
]ファイルを表示しキーウェイトを０秒、リピートカウントを25000に設定します。

A>DBMP H:AT*.BMP/Y/S
Ｈドライブのカレントディレクトリの[AT*.BMP]にマッチするファイルを縦方向の引き延
ばしをせずにオートスクロールモードで表示します。

A>dbmp b:\bmp\/lx/h
Ｂドライブの\BMP\ディレクトリにある隠しファイル・システムファイルを含む全ての[.
BMP]ファイルをノンインターレース・SCREEN 5で表示します。

H>DBMP A:\/C
Ａドライブのルートディレクトリにある全ての[.BMP]ファイルをＨドライブのカレント
ディクトリに再セーブします。

＊R800では/K0R25000、Z80では/KR3100オプションを付けて起動するとスクロールが速く
　て快適です。



４．環境変数

　環境変数 %DBMP% にオプションを設定出来ます。設定の仕方は、

　　SET DBMP=K0R25000

と、いった感じで行ってください。設定したオプションは、コマンドラインのオプショ
ンより先に解釈されます。

例）
A>SET DBMP=XLK1R30
A>DBMP /XK0
は、
A>DBMP /XLK1R30/XK0
と、解釈されます。

　また、ＭＡＧセーブ時に記録されるユーザー名には環境変数 %USER% の値が書き込ま
れます（ただし１８文字以内）。%USER%が設定されていない場合、ユーザー名には「 >
謎< 」と記録されます。



５．起動後の操作

　画像の表示後、次のキー操作が行えます。

    [UP]　　　　　上にスクロールします。
    [DOWN]　　　　下にスクロールします。
    [RIGHT]　　 　右にスクロールします。
    [LEFT]　　　　左にスクロールします。

    [SPACE]　　　 次の画像をロードします。
    [RETURN]　　　次の画像をロードします。

    [ESC]　　　　 DBMP.COMを終了します。
    [SELECT]　　　DBMP.COMを終了します。

    [CTRL]+[G]　　表示されている画像をＭＡＧセーブします。

    [CTRL]+[B]    表示されている画面をベタセーブします。

    [/]　　　　　 オプション入力モードになります。入力した文字は表示されません
　　　 　　　　　 入力し終わったら[SPACE]か[RETURN]で設定します。キャンセルは、
　　　　　　　　  [ESC] [SELECT]及びカーソルキーです。入力モードの終わりと初め
                  に画面がフラッシュします。又、オプションを設定しただけでは表
                  示に反映されませんので、必要な場合は[D]で再表示を行ってくださ
                  い。

　　[S]　　　　　 オートスクロールフラグを反転します。

　　[P]　　　　　 ３３７５色中１６色で表示するフラグを反転します。
    [F]           １５７５色中２５６色で表示するフラグを反転します。
    [E]           １５７５色中２５６色で表示するフラグを反転します。

    [D]　　　　　 画面の再表示を行います。[/]でオプションの設定を行った後等に利
　　　　　　　　  用してください。

    [L]　　　　　 ２００ラインフラグを反転します。
    [Y]　　　　　 ９８等の画像を縦方向に引き延ばすフラグを反転します。
    [X]  　　　　 １６色画像をSCREEN 7とSCREEN 5のどちらで表示するか決めている
                  フラグを反転します。

　ポート１・２のジョイスティックに対応しています。キーボードとの関係は次のよう
になっています。 

　スティック　＝　カーソルキー
　Ａボタン　　＝　[SPACE] [RETURN]
　Ｂボタン　　＝　[ESC] [SELECT]



６．参考

ＭＳＸ−Ｄａｔａｐａｃｋ　　　　　　　　　　　　　　（ＡＳＣＩＩ）
ＭＳＸテクニカルガイドブック 第４版４刷　　 　　　　（ＡＳＣＡＴ）
ＭＳＸテクニカルガイドブック ディスク編 第２版２刷  （ＡＳＣＡＴ）
機械語の手帳　　　　　　　　　　　　　　　　　　　　（ｒｏｏｔにゃんｐｌｕｓ）
DIBフォーマット概要　　　　　　　　　　　　　　　　 （Toshinobu Yashiro）
BMP.COMのドキュメント　　　　　　　　　　　　　　　 （青河）
まぐろーだー仕様書・非売品　　　　　　　　　　　　　（Woody RINN）



７．開発後記

(ver1.00)
　このプログラムを作る直接的なきっかけとなったのはWINDOWS版「おうちでＴＡＫＥＲ
Ｕ」を手に入れたことでした。このＣＤ−ＲＯＭにはかなりの数のＢＭＰファイルが入
っておりこれをＭＳＸで見られるようにしようと思ったのです。
　DMAG.COMを作るためのワンステップという意味合いもありました。

　実際に作るとき、問題になったのがＢＭＰの仕様が分からないということでした。結
局、ヘッダを読んで当たりをつけてプログラムに反映させていくという方法を取りまし
たが、ヘッダの意味が全て分かった訳ではないのでロード出来ないファイルもあると思
われます。

(ver1.10)
　そんな訳でＭＡＧセーバー付バージョンです。インターネットに仕様書が流れて来て
いてラッキーでした。
　このプログラムの存在意義はディスクスペースの有効利用、これに尽きます。私はＢ
ＭＰをディスクから追放する事に成功しました。
　とは言え、完全なものを作るためＢＭＰの仕様書が欲しい今日この頃です。

(ver1.11)
　まさかＢＭＰローダーでバグを出すとは思いもしませんでした。

(ver1.14)
　MM.COMから使う場合は、MMRET.DATに
.BMP	BMP $T/G
とでも書いておくとDBMP.COMからの復帰が速くなって便利です。が、コマンドラインで
指定するのは賢明ではありません。
　/Pオプションは色が微妙に違うような気がするので作ってみました。確かに色再現は
忠実になりますが、ちらつきが増えて使えないような。
　ユーザー名に %USER% を使うのは多分ver1.10からだと思いますがドキュメントに書く
のをすっかり忘れていました。大間抜け。

(ver1.15)
　ver1.14に引き続き「高忠実度色再現」を追求してみました。１５７５色中２５６色と
なっていますが実際は１５７５色同時表示できます。ただ元のデータが２５６色なので
この表現になった訳です。
　しかし、効果の程は？ですね。

(ver1.16)
　MS-Windows 3.x仕様のＢＭＰに正式対応した他、OS/2 v1.x/2.xのＢＭＰも見られるよ
うになりました。ＢＭＰの解説書を探して下さったＨＩＲＯさんに感謝、です。もちろ
ん、解説書資料を書かれたToshinobu Yashiroさんには大感謝！

　/Fオプションと/Eオプションはほとんど同じ動作を行いますが、/Fでは比率合わせを
しません。/Fで縦に潰れてしまうのが嫌な場合には/Eを使って下さい。ただし、通常の
２.５倍のメモリを必要とします（うわばみモード）。
　念の為に書いておきますが、ＭＳＸのSCREEN 8の画像では/F･/E両オプションを指定し
ても無視されます。

(ver1.18)
　これまでは、メモリに入り切らないファイルは飛ばしていましたが、可能な範囲で表
示するようになりました。空きメモリが少ない時でも一応、全てのファイルが見られま
す。

　また、ver1.00から存在していた「画面が乱れるバグ」が取れました。長いこと原因が
分からず、気持ちが悪かったのですが、これで安心して使えます。



８．バージョンアップ履歴

　1995/09/04　　ドットを間引かない・勝手にスクロールしない、ＢＭＰローダーを作
　　　　　　　　り始める

　　　 10/08　　[ver1.00]
　　　　　　　　とりあえず完成

　　　 10/25　　[ver1.01]
　　　　　　　　起動後にオプションの再設定をすると暴走するバグの修正
　　　　　　　　若干の高速化

　　　 11/27　　[ver1.10]
　　　　　　　　ＭＡＧセーバーの搭載
        　      /D・/Cオプションの追加

　　　 12/12    [ver1.11]
　　　　　　　　一部読み込めないファイルが存在したバグの修正
　　　　　　　　オートスクロール機能のテスト版を追加

　　　 12/17    [ver1.12]
　　　　　　　　ＭＡＧ部分セーブ時の不具合を修正
　　　　　　　　ベタセーブ機能の追加

       12/24    [ver1.13]
　　　　　　　　一部読み込めないファイルが存在したバグの修正
　　　　　　　　左・上スクロール時に画面端に出るゴミを除去

　1996/02/12　　[ver1.14]
　　　　　　　　/G・/Pオプションの追加
                ドキュメントに環境変数 %USER% の使用を明記

　　　 02/25　　[ver1.15]
                細かいバグの修正
                /Hオプションの使用方法を変更
　　　　　　　　/Fオプションの追加
　　　　　　　　キーウェイトの設定範囲を16bitに変更

       03/19    [ver1.16]
　　　　　　　　/Fオプション使用時のバグを修正
                /Eオプションの追加
                MS-Windows v3.x仕様のＢＭＰに正式対応
　　　　　　　　OS/2 v1.x/2.x仕様のＢＭＰに対応

　　　 03/28    [ver1.17]
　　　　　　　　細かいバグの修正
　　　　　　　　省メモリ化

　　　 04/09    [ver1.18]
　　　　　　　　空きメモリを超える大きさの画像も読める範囲で表示する様に変更
　　　　　　　　/Tオプションの追加
　　　　　　　　画面が乱れる事があるバグの修正
　　　　　　　　２色画像に対応



９．著作権・免責

　このプログラムはフリーソフトウェアとします。著作権は私Ａ ｔｏ Ｃが保有します
が、使用によって生じた如何なる損害に対しても作者は一切責任を負わないものとしま
す。

BMP format  Copyright(C)  Microsoft
MAG format  Copyright(C)  Woody RINN


質問・感想・苦情等は次のアドレスへ

インターネット電子メール
40sp1232@bosei.cc.u-tokai.ac.jp

郵政メール
〒２５７
　神奈川県秦野市南矢名５−１６−３　コーポ桂Ａ１０６号
　　　中山　淳
