
	◇＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝◇

			ＣＰＵ／クロックチェンジコマンド

				CCC.COM ver 0.11
							作者： にが

	◇＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝◇


■　はじめに

	よくあるターボＲのＣＰＵ切り替えの為のソフトですが、パナソニック
	Ａ１−ＷＸ／ＷＳＸ／ＦＸに装備されているＺ８０Ｂモードの高速クロ
	ックにも対応しています。



■　特長


	★　ターボＲのＣＰＵ３モードに対応

	★　ＷＸ／ＷＳＸ／ＦＸのクロックチェンジに対応





■　必要な物

	◇ＭＳＸターボＲ　又は　パナソニックＡ１−ＷＸ／ＷＳＸ／ＦＸ

	◇ＭＳＸ−ＤＯＳ（２）



■　使い方

	MSX-DOS(2)を起動し、CCC.COM を実行します。

	書式：「CCC /option」


	後述のオプションのいずれかを指定して下さい。指定の無い場合にはヘルプ
	メッセージをと共に、現在選択されているＣＰＵモードも表示します。

	対応マシン以外で無効なオプションを指定するとエラーメッセージを表示し
	て停止します。

	また、オプションタグには「-」、「/」が使えます。



	★ＭＳＸターボＲのみで有効なオプション

		◇ /Z オプション：ＣＰＵをＺ８０に切り替えます。
		◇ /R オプション：R800 ROM モード切り替えます。
		◇ /D オプション：R800 DRAM モードに切り替えます。

				　上記３つのオプションはターボＲを使用した時
				　のみ有効です。


	★Ａ１−ＷＸ／ＷＳＸ／ＦＸのみで有効なオプション

		◇ /A オプション：WX/WSX/FXでノーマルクロックに切り替えます
		◇ /B オプション：WX/WSX/FXで高速クロックに切り替えます

				　上記３つのオプションはＺ８０Ｂモードを装備
				　したマシンでのみ有効です。




		例）Ａ１−ＷＸを高速クロックに切り替える

					CPU /B
　　　　				~~~~~~



■　プログラム内部の話

	
	以下の様なルーチンによってＷＸ／ＷＳＸ／ＦＸであるかどうか判定し、
	クロックを切り替えてます。
	
	例）ＷＸで高速クロックに切り替えるルーチン
	
	LD	A,8
	OUT 	(040H),A	;I/O 40hにメーカーコード８（パナ）書く
	IN	A,(040H)	;上で書いた値を読む
	CPL			;読んだ値のビットを反転する
	CP	8		;反転値が書き込んだ値と一致しないなら
	JR	NZ,Not_WX	;　　　　　ＷＸ／ＷＳＸ／ＦＸではない
	XOR	A		;I/O 41hに０を書き込んで
	OUT	(041H),A	;　　　　　　高速クロックに切り替える

	ＷＸの高速モードをいじるためには、まずＩ／Ｏの40hにメーカーコード
	「8」を書き込む必要があります。もし、メーカーオプションとなってい
	る機能（この場合はＷＸの高速モード）が存在すれば、その直後に読みと
	ったI/Oの40hの値は、先ほど書き込んだ値のビットが反転した値になりま
	す。
	
	クロックを切り替えるときには、その上でI/Oの41hにデータを書き込みま
	す。データの bit 0 が０なら高速モード、１ならノーマルモードになりま
	す。41hの読みとった値のフォーマットも同様に、bit 0 が０なら高速モー
	ド、１ならノーマルモードとなっています。

	ターボＲのＣＰＵチェンジはお約束のＢＩＯＳを使用しているだけです。
	CHCPU(0180H/MAIN)、GETCPU(0183/MAIN)なんかを使っています。





■　怪情報

	最も初期に出荷されたＳＴには、ＷＸと同等のＺ８０Ｂモード（5.37MHZ）
	が装備されているという噂があります。このクロックチェンジコマンドで
	は、もしそのような規格のマシンがあればクロックチェンジできるように
	作ってあります。ＳＴをお持ちの方で、/A、及び/Bオプションを使えた方
	は、ご報告いただけると嬉しいです（この噂、かなり怪しいですが・・）




■　真情報

	ＤＯＳ１モードで起動したターボＲでは、高速モードでのディスクアクセ
	スに失敗することがあります。理由はＤＯＳ１のディスクカーネルには高
	速モードでアクセスするときにＣＰＵをＺ８０に落とすルーチンが無いか
	らです。 CCC.COMではＤＯＳ１モードでＲ８００に切り替えることも可能
	となっていますが、この時ＦＤＤへの書き込みはしないほうが良いでしょ
	う。ディスクが壊れます。



■　謝辞

	ＷＸの高速モードの判定法情報を頂いた「つじかわ」さん、「めらまん」さん
	
	動作試験、要望を頂いた「みかせん」さん
	
	ありがとうございました。




■　お約束

	このソフトはフリーソフトウェアです。

	このソフトの使用は個人の責任において行って下さい。使用によって何らか
	の損害を生じた場合でも、当方は責任を負いかねます。

	転載、配布は内容を変えない限り自由です。改変がなければアーカイブ形式
	の変更も自由です。



■　連絡先						にが

						ナツメネット：　NAT28073
						MXK03753@niftyserve.or.jp
						nigawara@es.sapmed.ac.jp
						がっしーねっと：にがにが

