1 '      save"zeld.bas"
10 COLOR15,8,1:SCREEN5,2:DEFINTA-Z:OPEN"grp:"FOROUTPUTAS#1
20 SETPAGE0,3:BLOAD"zeldat16.sc5",S:COLOR=RESTORE
30 SETPAGE0,0:FORI=0TO128:LINE(128-I,56)-(128-I,156),12:LINE(128+I,56)-(128+I,156),12:NEXT
40 FORI=0TO28STEP2:COPY(0,30-I)-(125,28-I),3TO(69,108-I),0:COPY(0,28+I)-(125,30+I),3TO(69,106+I),0:NEXT
50 FORI=0TO8:COPY(126,I)-(256,I),3TO(64,160+I),0:NEXT:BLOAD"zelda.sp5",S
60 SETPAGE0,1:BLOAD"zelda.vpk",S
70 SETPAGE0,2:BLOAD"zelda.sc5",S
80 SETPAGE0,0:FORI=11TO19:COPY(126,I)-(256,I),3TO(64,149+I),0:NEXT
100 IFSTRIG(0)THENCLSELSE100
1000 CALLTURBOON
1010 DIMX(8),Y(8),G(2),C(3),D(1),J(1)
1020 SOUND13,13
1060 COPY(0,59)-(255,89),3TO(0,0),0:Z=4:X(3)=2:X(7)=-2:Y(1)=-2:Y(5)=2:R=0:RR=1:GL=0:LM=50:GOSUB14660:ONSPRITEGOSUB17000
1100 SPRITEOFF:ZT=2:N=0:X=32:Y=64:Z=4:X(3)=2:X(7)=-2:Y(1)=-2:Y(5)=2:R=0:RR=1:SE=2
1200 GOSUB20000
2000 GOTO31000
2002 G=STRIG(0):IFEG<1THENS=STICK(0):NX=X+X(S):NY=Y+Y(S):Z=-Z*(SMOD2=0)-(S-1+(1AND((XMOD16)/8)+((YMOD16)/8)))*((SMOD2)=1):EG=EG-1*(EG<0)ELSEEG=EG-1:MB=4:MA=EG:GOSUB30040:GOTO5070
2005 OUT&HAA,5:UU=INP(&HA9):IFUU=247ANDC(3)>0ANDLI<LMTHENI=3:C(I)=C(I)-1:GOSUB14600:LJ=LI:LJ=LJ+20:GOSUB14650
2010 PN=-1*(NX=242)-2*(NX=-2)-3*(NY=194)-4*(NY=30):ONPNGOTO10000,10010,10020,10030
2020 VA=VPEEK(VN+INT((4+NX)/16)+INT((NY+14)/16)*16):VB=VPEEK(VN+INT((11+NX)/16)+INT((NY+14)/16)*16)
2030 IFS=1ANDVA>150ANDVB>150THENTA=1:VT=VA:TY=NY
2040 IFVA<64ANDVB<64THENX=NX:Y=NYELSEVA=0:VB=0
2050 IF(VA>31ORVB>31)ANDTA=0THENTA=2
2060 'PRESET(10,22):PRINT#1,eg
2070 IF INKEY$="q"THEN60000
2800 IFZS>0THENZS=ZS-1:ZT=ZSMOD2+2:MB=ZT-2:MA=200+ZS:GOSUB30040:GOTO3000ELSESPRITEON
2900 IFG=-1ANDEP>0ANDEG=0THEN5000
2950 SOUND8,0
3000 GOSUB14000
3080 ONTAGOTO15000,10100
3090 GOSUB16000
3100 '
4000 GOTO2000
5000 EG=25:ZE=Z:NE=36+INT(Z/2):Z=24+INT(Z/2):YE=Y+16*(Z=24)-16*(Z=26):XE=X+16*(Z=27)-16*(Z=25):SE=1
5050 GOSUB14000:PUTSPRITE6,(XE,YE-1),8,NE:PUTSPRITE7,(XE,YE-1),EP,NE+4
5070 IFEG<15ANDG=0THENEG=1:SOUND8,0
5080 IFEG=1THENGOSUB25050:EG=-20:Z=ZE:SE=2:GOTO2000
5100 VV=VN+INT((8+XE)/16)+INT((YE+14)/16)*16:VA=VPEEK(VV):IFVA>140ANDVA<(145+EP*2)THENEG=1:VO=VA-135+6*(VA=141)+7*(VA=142):VM=32+16*(VA=141)+32*(VA=142):VY=INT((YE+14)/16)*16:VX=INT((XE+8)/16)*16:GOSUB14500
5500 FORI=0TO200:NEXTI:
9000 GOTO3000
10000 N=N+1:X=0:GOTO 1200
10010 N=N-1:X=240:GOTO 1200
10020 N=N+3:Y=32:GOTO 1200
10030 N=N-3:Y=192:GOTO 1200
10100 MA=0:TA=0:MB=0:VV=VN+INT((8+X)/16)+INT((Y+14)/16)*16:VY=INT((Y+14)/16)*16:VX=INT((X+8)/16)*16:VM=((VA+1)MOD2)*16:VO=0
10110 IFVA>31ANDVA<35ANDVB>31ANDVB<35THENLE=10:MB=3:GOSUB14400:GOTO14300
10115 IFVA<>VBTHEN2000
10120 IFVA<39THENN=N+21:Y=176:GOTO1200
10130 IFVA=39THENN=N-21:Y=50:GOTO1200
10140 IFVA<42THENLJ=LI:LJ=LJ+10::GOSUB14500:GOSUB14650:GOTO2000
10150 IFVA<48THENGL=GL+INT((VA-38)/2):GOSUB14500:GOSUB14550:GOTO2000
10160 IFVA<56THENI=INT((VA-48)/2):C(I)=C(I)+1:C(I)=-C(I)*(C(I)<10)-9*(C(I)>9):GOSUB14600:GOSUB14500:GOTO 2000
10170 IFVA<58THENLM=LM+20:GOSUB14500:GOSUB14660:GOTO2000
10190 IFVA<61THENEP=VA-57:VM=16:GOSUB14500:COPY(147+EP*16,162)-(157+EP*16,174),2TO(132,1),0:GOTO2000
10200 BO=VA-60:VM=16:GOSUB14500:COPY(194+BO*16,162)-(205+BO*16,174),2TO(143,1),0:GOTO2000
11111 GOTO 3100
14000 PUTSPRITE0,(X,Y-1),40,Z:PUTSPRITE1,(X,Y-1),38,Z+4*SE:PUTSPRITE2,(X,Y-1),ZT,Z+8*SE:RETURN
14300 FORI=0TO15:Z=(IMOD8):GOSUB14000:ZT=1:GOSUB30030:FORJ=0TO600:NEXTJ:NEXTI:SOUND8,0:GOTO 1100
14400 LJ=LI:LJ=LJ-LE:LJ=-LJ*(LJ>0):FORI=LITOLJSTEP-1:COPY(60,75)-(60,77),3TO(2+I,16),0:NEXTI:LI=LJ:RETURN
14500 VPOKEVV,VM+VO:COPY(VO*16,VM)-(15+VO*16,15+VM),2TO(VX,VY),0:G(0)=INT(GL/100):GOSUB30000:RETURN
14550 G(0)=INT(GL/100):G(1)=INT((GL-(G(0)*100))/10):G(2)=GL-G(1)*10-G(0)*100:FORI=0TO2:COPY(12+G(I)*6,201)-(17+G(I)*6,207),2TO(14+I*7,4),0:NEXTI:RETURN
14600 COPY(12+C(I)*6,201)-(17+C(I)*6,207),2TO(51+I*23,4),0:RETURN
14650 LJ=-LJ*(LJ=<LM)-LM*(LJ>LM):FORI=LITOLJ:COPY(2,76)-(2,76),3TO(I+2,17),0:MA=I:MB=1:NEXTI:LI=LJ:RETURN
14660 LM=-LM*(LM=<252)-252*(LM>252):COPY(1,17)-(1,17),3TO(3+LM,17),0:LJ=LM:GOSUB14650:RETURN
15000 MB=1:TA=0:VV=VN+INT((8+X)/16)+INT((TY+14)/16)*16:VY=INT((TY+14)/16)*16:VX=INT((X+8)/16)*16
15010 IFVT<160THENCT=(VT+2)MOD3:IFC(CT)>0THENTT=INT((VT-148)/3):I=CT:C(I)=C(I)-1:GOSUB14600:ONTTGOTO20100,20200,20300ELSEMB=2:GOSUB30000:GOTO2000
15020 IFVT<163THEN21000
15100 VM=112:VO=15:VA=(VT*2)-284:GOTO10150
15900 GOTO2000
16000 IFNS=0THEN16490
16010 SS=SS+1:IFSS=10THENSWAPR,RR:SS=0
16015 ONHGOTO16020,16100,16400
16020 IFGS=0THENXN=XN+DSELSEYN=YN+SD
16030 IFXN=XTHENGS=1:SD=1*(SY>Y)-1*(SY<Y)
16040 IFYN=YTHENGS=0:DS=1*(SX>X)-1*(SX<X)
16090 VS=VPEEK(VN+INT((8+XN)/16)+INT((YN+14)/16)*16):IFVS>37THENDS=-DS:SD=-SD:XN=SX:YN=SYELSESX=XN:SY=YN:GOTO 16110
16100 SX=SX+DS:SY=SY+SD
16110 IFSX<1ORSX>239THENDS=-DS
16120 IFSY<33ORSY>191THENSD=-SD
16150 GOTO16470
16400 SX=SX+DS:SY=SY+SD
16410 IFSX<1ORSX>239THENDS=-DS:SD=1*(SY>Y)-1*(SY=<Y):IFDSMOD2=1THENDS=DS*2
16420 IFSY<31ORSY>191THENSD=-SD:DS=1*(SX>X)-1*(SX<X):IFSDMOD2=1THENSD=SD*2
16430 IFSY=YTHENSD=0:DS=1*(SX>X)-1*(SX<X)
16470 PUTSPRITE3,(SX,SY),40,SN+R:PUTSPRITE4,(SX,SY),38,SN+2+R:PUTSPRITE5,(SX,SY),SC,SN+4+R
16480 RETURN
16490 FORI=0TO200:NEXTI:SF=SF+1*(SF>-1):IFSF=0THEN20030ELSERETURN
17000 SPRITEOFF:IFEG=0THEN17010ELSEIFSY>Y-15-8*(NE=48)ANDSY<Y+15+8*(NE=50)ANDSX>X-15-8*(NE=51)ANDSX<X+15+8*(NE=49)THEN17010ELSE17020
17010 ZS=20:LE=(SC*3)-BO:GOTO14400
17020 SF=SF-EP:EG=-20:Z=ZE:SE=2:GOSUB25050:IFSF<1THENNS=0:SF=60:GOSUB25000
17030 RETURN
20000 SPRITEOFF:VN=&H8300+N*256:FORI=0TO8:PUTSPRITEI,(0,211),,63:NEXTI
20010 FORI=0TO15:FORJ=2TO12:VA=VPEEK(VN+I+J*16):VY=(INT(VA/16))*16:VX=(VAMOD16)*16:COPY(VX,VY)-(15+VX,15+VY),2TO(I*16,J*16),0:NEXTJ:NEXTI
20030 SX=VPEEK(VN+211):SX=SX*16:SY=VPEEK(VN+212):SY=SY*16:NS=VPEEK(VN+210):SN=INT((NS-1)/3):SC=1+(NS-1)MOD3:SF=SC:H=SN+1:DS=1-1*(H=2):SD=DS:SN=SN*6+44:XN=SX:YN=SY
20090 RETURN
20100 VM=160:VO=VPEEK(VN+213)-160:GOSUB14500:GOTO21100
20200 VM=16:VO=13:GOSUB14500:GOTO21100
20300 VM=32:VO=5:GOSUB14500:GOTO21100
21000 FORI=0TO35:T=VPEEK(VN+218+I):COPY(T,201)-(5+T,208),2TO(3+I*7,200),3:COPY(3,200)-(3+I*7,207),3TO(250-I*7,22),0:MA=T:MB=0:GOSUB30010:NEXTI
21100 SOUND8,0:S=STICK(0):IFS>3ANDS<7THEN21200ELSE21100
21200 TA=0:FORI=0TO34:COPY(0,151)-(6,158),3TO(3+I*7,22),0:COPY(O,151)-(6,158),3TO(2+I*7,200),3:NEXTI:GOTO2040
25000 PUTSPRITE3,(0,211),,63:PUTSPRITE4,(0,211),,63:PUTSPRITE5,(0,211),,63
25050 PUTSPRITE6,(0,211),,63:PUTSPRITE7,(0,211),,63
25100 RETURN
30000 SOUND1,MB:FORL=250TO0STEP-1:SOUND0,L:GOSUB30020:NEXTL:SOUND8,0:RETURN
30010 SOUND0,MA:SOUND1,MB
30020 FORK=7TO14:SOUND8,K:NEXTK:RETURN
30030 SOUND1,MB:FORL=250TO0STEP-1:SOUND0,L:SOUND8,13:NEXTL:SOUND8,0:RETURN
30040 SOUND0,MA:SOUND1,MB:SOUND8,12:RETURN
31000 FORI=0TO1:IFD(I)=0THEN31100ELSE31500
31100 SOUND9+I,0:IFI=1THEN31200ELSESOUND12,66:SOUND11,16
31200 A(I)=VPEEK(&H8000J(I)+(I*384)):B(I)=VPEEK(&H8080+J(I)+(I*384)):D(I)=VPEEK(&H8100+J(I)+(I*384)):SOUND2+(I*2),A(I):SOUND3+(I*2),B(I):SOUND9+I,16-(I*3):J(I)=J(I)+1
31300 IFD(I)=0THENJ(I)=0:GOTO31100
31500 D(I)=D(I)-TT:PUTSPRITE5+I,(J(I)*2,140),8+I,56
31550 NEXTI:GOTO2005
60000 CALL TURBO OFF
60010 COLOR15,4,4:SCREEN0:WIDTH80:END
